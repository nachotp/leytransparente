{% extends 'base.html' %}
{% load static %}
{% block head_end %}
  <link rel="stylesheet" href="{% static 'lib/DataTables/dataTables.bootstrap4.min.css' %}">
  <script type="text/javascript" charset="utf8" src="{% static 'lib/DataTables/jquery-3.3.1.min.js' %}"></script>
  <script type="text/javascript" charset="utf8" src="{% static 'lib/DataTables/jquery.dataTables.min.js' %}"></script>
  <script type="text/javascript" charset="utf8" src="{% static 'lib/DataTables/dataTables.bootstrap4.min.js' %}"></script>
  <script type="text/javascript" charset="utf8" src="{% static 'lib/DataTables/Spanish.js' %}"></script>
{% endblock %}

{% block content %}
<b-row>
    <b-col>
        <h2>Declaraciones de Diputados</h2>
    </b-col>
    <b-col>
        <b-button v-b-modal.my-modal size="lg" variant="primary" class="mb-3 float-right"><i class="fas fa-file-upload"></i> <b>Subir Declaracion</b></b-button>

        <b-modal id="my-modal" title="Nueva Declaración de Patrimonio" hide-footer>
            <form name='load_file_form' method='POST' action="{% url 'Subir declaracion' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <h5>Subir JSON de la declaración de patrimonios</h5>
                    <p>Subir una nueva declaración de patrimonios para un parlamentario ya ingresado actualizará la declaración existente para futuros análisis de conflictos de interés.</p>
                        <b-form-file
                          name='uploaded_file'
                          placeholder="Elegir archivo..."
                          drop-placeholder="Arrastrar archivo aquí..."
                          browse-text="Examinar"
                          class="my-3"

                        ></b-form-file>

                <b-button block type="submit" variant="primary"><i class="fas fa-file-upload"></i> Subir Archivo</b-button>
            </form>
        </b-modal>
    </b-col>
</b-row>
    <div class="container" style="max-width: 1450px">
        <table  class="table table-striped table-bordered compact" id="dip_table" cellspacing="0">
            <thead>
                <tr>
                    <td>Nombre</td>
                    <td>Apellido Paterno</td>
                    <td>Apellidos Materno</td>
                    <td>Fecha Declaracion</td>
                    <td></td>
                </tr>
            </thead>
            <tbody>
                {% if diputados %}
                {% for diputado in diputados %}
                <tr>
                    <td>{{ diputado.nombres|title }}</td>
                    <td>{{ diputado.apellido_paterno|title }}</td>
                    <td>{{ diputado.apellido_materno|title }}</td>
                    <td>{{ diputado.fecha_declaracion }}</td>
                    <td class="align-middle">
                        <div class="text-center">
                            <a class="" href="{% url 'Ver Declaracion' id=diputado.id %}" >Ver Declaración</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}

                {% else %}
                <h1>No hay registros de Parlamentarios</h1>
                {% endif %}
            </tbody>
        </table>
    </div>
{% endblock%}

{% block body_end %}
<script>

$(document).ready(function() {
    var table = "#dip_table";
    console.log('creating table '+table);

    var diputable = $(table).DataTable({
        "language": langSpanish,
        orderCellsTop: true,
        "order": [[ 0, "desc" ]],
        "paging":         true,

    });
});
</script>
{% endblock %}